
<div class="addressCenter clearfix costCenter">
	<div class="clearfix addressContent">
		<if condition="!empty($staff_costs)">
		<foreach name="staff_costs" item="scost">
			<div class="costinfo" scenterid="{$scost.staffcenter_id}" cdefault="{$scost.staffcenter_default}">
				<div class="infoContent">
					<div class="costName">
						<span>{$scost.center_name}</span>
						<div class="currentIcon">
							<i class="iconfont scdefault" title="{:L('SET_COSTCENTER_DEFAULT')}">&#xe63c;</i>
							<i class="iconfont delete_icon" title="{:L('COSTCENTER_DELETE')}">&#xe673;</i>
						</div>
					</div>
					<span class="costOffice">{:L('COSTOFFICE')}：{$scost.office}</span>
					<span class="costCity">{:L('CITY')}：{$scost.city}</span>
					<span class="costDelivery">{:L('COSTDELIVERY')}：{$scost.delivery_no}</span>
					<span class="costContact">{:L('COSTCONTACT')}：{$scost.contacts}</span>
					<span class="costMobile">{:L('MOBILE')}：{$scost.mobile}</span>
				</div>
			</div>
		</foreach>
		</if>
		<div url="{:U('Xing/centersAdd')}" class="add">
			<div class="addIcon">
				<i class="iconfont add-icon">&#xe633;</i>
				<p>{:L('ADD_COSTCENTER')}</p>
			</div>
		</div>
	</div>
	<div class="paging-content">
		<div id="address-paging" class="tcdPageCode"></div>
	</div>
</div>
<script src="__PUBLIC__/js/common.js"></script>

<script type="text/javascript">	
	$(function(){
		document.getElementById('anchorTop').scrollIntoView();//默认到顶部
		var noty_btn = false; //设置一个btn开关
		defaultcost(); //显示默认成本中心

		//鼠标移入事件
		$(".costinfo").on("mouseenter",function(){
			$(this).find(".currentIcon").css("display","inline-block");
			$(this).addClass("currentInfo");
		});
		$(".costinfo").on("mouseleave",function(){
			$(this).find(".currentIcon").css("display","none");
			$(this).removeClass("currentInfo");
		});

		$('.delete_icon').on('click',function(){
			var scenter_id = $(this).parents(".costinfo").attr("scenterid");
			$.ajax({
				url:'{:U("CostCenter/Cost_Del")}',
				method:'post',
				data:'staffcenter_id='+scenter_id,
				success:function(data){
					if(data.status == 1){
						noty({
	                        text: data.info,
	                        type:"success",
	                        layout:"center"
	                     });
					}else{
						noty({
	                        text: data.info,
	                        type:"error",
	                        layout:"center"
	                     });
					}
					
					$(".main-content").load('{:U("Xing/costCenter")}');
				}
			});
		});

		$(".scdefault").on('click',function(){
			var scid = $(this).parents(".costinfo").attr("scenterid");
			var current_sc = $(this).parents(".costinfo");
			if(noty_btn){
				return;
			}
			noty_btn = true;
			$.ajax({
				url:'{:U("CostCenter/CostDefault")}',
				method:'post',
				data:{'staffcenter_id':scid},
				success:function(data){
					if(data.status == 1){
						noty({
		                        text: data.info,
		                        type:"success",
		                        layout:"center"
		                     });
						$(".costinfo").attr('cdefault','0');
					    current_sc.attr('cdefault','1');
					    defaultcost();
					}else{
						noty({
		                        text: data.info,
		                        type:"error",
		                        layout:"center"
		                     });
					}
					noty_btn = false;
				}
			});
		});
		//默认成本中心样式
		function defaultcost(){
			$(".costinfo").each(function(){
				var cdefault = $(this).attr("cdefault");
				if(cdefault == 1){
					$(this).addClass("defaultCost");
				}else{
					$(this).removeClass("defaultCost");
				}
			});
		}

		/*新增*/
		var addnum = 20;
		var dnum = $('.costinfo').length; 
		$('.add').on('click',function(){
			if(dnum > addnum){
				alert("{:L('FULL_ADD_NUM')}");
			}else{
				//添加成本中心弹出层
				Wind.use('artDialog', 'iframeTools', function () {
                var url = "{:U('Xing/centersAdd')}";
                art.dialog.open(url, {
                    title: '新增成本中心',
                    lock: true,
                    height: "30%",
                    width: "30%",
                    // 在open()方法中，init会等待iframe加载完毕后执行
                    init: function () {
                        var iframe = this.iframe.contentWindow;
                        var top = art.dialog.top;// 引用顶层页面window对象
                    },
                    ok: function () {	
                        var iframe = this.iframe.contentWindow;
                        if (!iframe.document.body) {
                            art.dialog.tips('Loading......', 1.5);
                            return false;
                        }                        
                    	// 获取iframe嵌套内容
                    	var alertData =  iframe.document.getElementById('center_id').value;
                    	$.ajax({
							url:"{:U('CostCenter/Cost_Add')}",
							method:"post",
							data:{'center_id':alertData},
							success:function(data){
								if(data.status == 1){
									// alert(data.info);
									noty({
				                        text: data.info,
				                        type:"success",
				                        layout:"center"
				                     });
									$(".main-content").load('{:U("Xing/costCenter")}');
								}else{
									noty({
				                        text: data.info,
				                        type:"error",
				                        layout:"center"
				                     });
									return false;
								}
							}
						}); //ajax end          	
                    },
                    cancel: true
                });
            });
				// var url = $('.add').attr("url");
				// $(".main-content").load(url);
			}
			
		});
	});
</script>