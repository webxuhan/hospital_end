<!-- 地址管理 -->
<div class="addressCenter clearfix two">
	<div class="clearfix addressContent">
		<if condition="isset($addressinfo)">
		<foreach name="addressinfo" item="info">
			<div class="info" style="float:left;" id="{$info.delivery_id}" deadresss="{$info.delivery_default}">
				<div class="infoContent">
					<div class="deliveryName">
						<span>{$info.delivery_name}</span>
						<div class="currentIcon">
							<i class="iconfont addressDefault" title="{:L('ADDRESS_DEFAULT')}">&#xe63c;</i>
							<i class="iconfont adrressEdit" title="{:L('ADDRESS_EDIT')}">&#xe623;</i>
							<i class="iconfont addressDelete" title="{:L('ADDRESS_DELETE')}">&#xe673;</i>
						</div>
					</div>
					<span class="deliveryMobile">{$info.delivery_mobile}</span>
					<span class="deliveryAddress">{$info.delivery_address}</span>
					<span>{$info.delivery_postcode}</span>
				</div>
			</div>
		</foreach>
		</if>
		<if condition="$current_page eq $total_page">
		<div url="{:U('Xing/addressAdd')}" class="add">
			<div class="addIcon">
				<i class="iconfont add-icon">&#xe633;</i>
				<p>{:L('ADDRESS_ADD')}</p>
			</div>
		</div>
	</if>
	</div>
	<div class="paging-content">
		<div id="address-paging" class="tcdPageCode"></div>
	</div>
</div>

<script type="text/javascript" src="__PUBLIC__/js/jquery.page.js" ></script>
<script type="text/javascript">
	var noty_btn = false; //btn开关
	$(function(){
		settingdeaddress();
		if({$total_page} > 1){
			$(".paging-content").css("display","block");
		}else{
			$(".paging-content").css("display","none");
		}
		//分页管理
		$("#address-paging").createPage({
	        pageCount:{$total_page},
	        current:{$current_page},
	        backFn:function(page){
	        	$('.main-content').load("{:U("Xing/addressCenter")}",{page:page});
	        }
	    });
		//地址添加
		$(".addressCenter .add").on("click",function(){
			var url = $(this).attr("url");
			$(".main-content").load(url);
		})
		//鼠标移入事件
		$(".info").on("mouseenter",function(){
			$(this).find(".currentIcon").css("display","inline-block");
			$(this).addClass("currentInfo");
		});
		$(".info").on("mouseleave",function(){
			$(this).find(".currentIcon").css("display","none");
			$(this).removeClass("currentInfo");
		});
		
		$(".info .adrressEdit").on('click',function(){
			var delivery_id = $(this).parents(".info").attr('id');
			var delivery='{:U("Address/AddressEdit")}' + '&delivery_id='+delivery_id;
			$(".main-content").load(delivery);
		});

		$(".info .addressDelete").on('click',function(){
			var delivery_id = $(this).parents(".info").attr('id');
			if(noty_btn){
				return;
			}
			noty_btn = true;
			$.ajax({
				url:'{:U("Address/AddressDelete")}',
				method:'post',
				data:{'delivery_id':delivery_id},
				success:function(data){
					if(data.status == 1){
						noty({
		                        text: data.info,
		                        type:"success",
		                        layout:"center"
		                     });
						$('.main-content').load('{:U("Xing/addressCenter")}');
					}else{		
						noty({
	                        text: data.info,
	                        type:"error",
	                        layout:"center"
	                     });	
					}
					noty_btn = false;
				}
			});
		});
		$(".info .addressDefault").on('click',function(){
			var delivery_id = $(this).parents(".info").attr('id');
			var deadresss =  $(this).parents(".info");
			if(noty_btn){
				return;
			}
			noty_btn = true;
			$.ajax({
				url:'{:U("Address/AddressDefault")}',
				method:'post',
				data:{'delivery_id':delivery_id},
				success:function(data){
					if(data.status == 1){
						noty({
		                        text: data.info,
		                        type:"success",
		                        layout:"center"
		                     });
						$(".info").attr("deadresss","0");
						deadresss.attr("deadresss","1");
						settingdeaddress();
					}else{
						noty({
		                        text: data.info,
		                        type:"error",
		                        layout:"center"
		                     });
					}
					noty_btn = false;	
				}
			});
		});
		function settingdeaddress(){
			$(".info").each(function(index,item){
				var tt = $(this).attr("deadresss");
				if(tt == 1){
					$(this).addClass("defultAddress");
				}else{
					$(this).removeClass("defultAddress");
				}
		});
		}
	})
</script>